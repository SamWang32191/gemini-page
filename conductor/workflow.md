# 專案工作流

## 指導原則

1. **計畫是事實來源：** 所有工作都必須在 `plan.md` 中追蹤
2. **技術堆疊經過審慎選擇：** 技術堆疊的變更必須在實作*之前*先記錄於 `tech-stack.md`
3. **靈活開發：** 根據專案需求進行開發，不強制要求單元測試。
4. **效能與美學：** 每個決策都應優先考量使用者體驗與 Canvas 生成內容的品質。
5. **使用者體驗優先：** 每個決策都應優先考量使用者體驗
6. **非互動式與 CI 感知：** 優先使用非互動式命令。

## 任務工作流

所有任務遵循嚴格的生命週期：

### 標準任務工作流

1. **選擇任務：** 從 `plan.md` 中按順序選擇下一個可用的任務

2. **標記為進行中：** 開始工作前，編輯 `plan.md` 並將任務狀態從 `[ ]` 更改為 `[~]`

3. **實作功能：**
   - 撰寫應用程式碼。
   - 確保符合 `product-guidelines.md` 中的設計規範。

4. **驗證功能：** 手動驗證功能是否按預期運作。

5. **記錄偏差：** 如果實作與技術堆疊有所不同：
   - **停止**實作
   - 使用新設計更新 `tech-stack.md`
   - 加入帶日期的說明解釋變更
   - 繼續實作

6. **提交程式碼變更：**
   - 暫存 (stage) 與任務相關的所有程式碼變更。
   - 提議一個清晰、簡潔的提交訊息，例如：`feat(ui): <任務名稱>`。
   - 執行提交。

7. **使用 Git Notes 附加任務摘要：**
   - **步驟 7.1：取得提交雜湊：** 取得*剛完成提交*的雜湊 (`git log -1 --format="%H"`)。
   - **步驟 7.2：草擬備註內容：** 為已完成的任務建立詳細摘要。這應包含任務名稱、變更摘要、所有建立/修改檔案的清單，以及變更的核心「原因」。
   - **步驟 7.3：附加備註：** 使用 `git notes` 命令將摘要附加到提交。
     ```bash
     git notes add -m "<note content>" <commit_hash>
     ```

8. **取得並記錄任務提交 SHA：**
    - **步驟 8.1：更新計畫：** 讀取 `plan.md`，找到已完成任務的行，將其狀態從 `[~]` 更新為 `[x]`，並附加*剛完成提交*的提交雜湊前 7 個字元。
    - **步驟 8.2：寫入計畫：** 將更新的內容寫回 `plan.md`。

9. **提交計畫更新：**
    - **行動：** 暫存修改後的 `plan.md` 檔案。
    - **行動：** 使用描述性訊息提交此變更 (例如：`conductor(plan): <階段名稱>`)。

### 階段完成驗證與檢查點協議

**觸發條件：** 此協議在完成一個任務且該任務同時結束 `plan.md` 中的一個階段後立即執行。

1.  **宣佈協議開始：** 告知使用者該階段已完成且驗證和檢查點協議已開始。

2.  **提出詳細、可操作的手動驗證計畫：**
    -   你**必須**生成一個逐步計畫，引導使用者完成驗證過程。
    -   格式範例：
        ```
        對於手動驗證，請遵循以下步驟：
        1. **在瀏覽器中開啟：** `index.html`
        2. **確認你看到：** <預期結果>
        ```

3.  **等待使用者明確回饋：**
    -   詢問確認：「**這是否符合你的期望？請確認 yes 或提供回饋。**」
    -   **暫停**並等待回覆。

4.  **建立檢查點提交：**
    -   暫存所有變更。
    -   執行提交（例如：`conductor(checkpoint): 階段X 檢查點`）。

5.  **使用 Git Notes 附加驗證報告：**
    -   將手動驗證步驟與結果報告附加為 Git note。

6.  **更新計畫：** 將檢查點 SHA 記錄於 `plan.md`。

## 品質關卡

在將任何任務標記為完成之前，請驗證：

- [ ] 程式碼遵循專案的程式碼風格指南
- [ ] 所有公開函式/方法都已記錄文件
- [ ] 在行動裝置上正常運作 (如適用)
- [ ] 文件已視需要更新

## 提交指南

### 類型
- `feat`: 新功能
- `fix`: 錯誤修復
- `docs`: 僅文件
- `style`: 格式化、UI 調整
- `refactor`: 重構
- `test`: 測試
- `chore`: 維護

## 完成定義

當滿足以下條件時，任務即為完成：

1. 所有程式碼按規格實作
2. 手動驗證通過
3. 文件完成（如適用）
4. 實作備註已加入 `plan.md`
5. 變更已使用適當訊息提交
6. 帶有任務摘要的 Git note 已附加到提交
